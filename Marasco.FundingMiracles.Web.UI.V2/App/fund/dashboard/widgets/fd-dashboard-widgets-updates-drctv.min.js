"use strict";fundoloApp.directive("fdDashboardWidgetsUpdatesDrctv",function(){var n={};return n.restrict="E",n.transclude=!0,n.replace=!0,n.templateUrl="/app/fund/dashboard/widgets/fd-dashboard-widgets-updates-drctv.min.html",n.link=function(n){n.$watch("showFeed",function(t,i){if(t===undefined&&i===undefined){n.showFeed=!0;return}n.showFeed=t==="true"||t===!0})},n.controller=["$scope","$log","$stateParams","$location","$timeout","$window","fdDashboardSvc","seAuthSvc","Facebook","twitterConfiguration",function(n,t,i,r,u,f,e,o,s,h){function l(){n.fundUpdate.content="";n.isDeleting=!1;n.facebookIt=!1;n.tweetIt=!1;n.mailIt=!1}function c(t){n.user.facebookToken=t.authResponse;o.extendUser(n.user);o.postClaim("Facebook",t.authResponse.accessToken).then(function(){n.isSaving=!1},function(){toastr.error("Facebook gnomes are on the prowl.  Refresh your page and try again.")})}n.$watch(function(){return s.isReady()},function(){n.facebookReady=!0});n.$watch("fundId",function(t){t!==undefined&&t>0&&n.initialize()});n.isLoading=!0;n.isSaving=!1;n.facebookIt=!1;n.tweetIt=!1;n.mailIt=!1;n.twittered=!1;n.user=o.user;n.addDeleting=function(){angular.forEach(n.fundUpdates,function(n){n.isDeleting=!1})};n.facebookMark=function(){n.facebookIt=!n.facebookIt};n.intentLogin=function(t,i){var r=t.target;if(r.checked)switch(i){case"Facebook":if(n.user.isExternal&&n.user.externalProvider==="Facebook")return;if(angular.isDefined(n.user.facebookToken))return;n.facebookGetLoginStatus();break;case"Twitter":n.twitterGetLoginStatus()}};n.intentLoginButton=function(t){switch(t){case"Email":n.mailIt=!n.mailIt;break;case"Facebook":if(n.facebookIt=!n.facebookIt,!n.facebookIt)return;if(n.user.isExternal&&n.user.externalProvider==="Facebook")return;if(angular.isDefined(n.user.facebookToken))return;n.facebookGetLoginStatus();break;case"Twitter":if(n.tweetIt=!n.tweetIt,!n.tweetIt)return;n.twitterGetLoginStatus()}};n.facebookLogin=function(){n.isSaving=!0;s.login(function(t){t.status=="connected"?(n.isSaving=!0,c(t)):(toastr.error("There was a problem connecting to Facebook.  Please refresh and try again"),n.facebookIt=!1,n.tweetIt=!1,n.isSaving=!1)})};n.me=function(){s.api("/me",function(t){n.$apply(function(){n.user=t})})};n.facebookGetLoginStatus=function(){s.getLoginStatus(function(t){t.status=="connected"?c(t):n.facebookLogin()})};n.twitterGetLoginStatus=function(){return n.twittered||f.open(h.signInUrl+n.fundId,"Funding Miracles Authorization","width=650,height=400,toolbar=0,menubar=0,location=1,status=1,scrollbars=1,resizable=1,left=0,top=0"),n.twittered=!0,!1};n.mailMark=function(){n.mailIt=!n.mailIt};n.viewPost=function(){r.path(n.permalink)};n.saveFundUpdate=function(t){n.isSaving=!0;this.updateForm.$valid?(t.fundId=this.fundId,t.fund=n.fund,t.postedToFacebook=n.facebookIt,t.postedToTwitter=n.tweetIt,t.postedToEmail=n.mailIt,e.saveUpdate(t).then(function(t){n.fundUpdates.push(t);n.fund.updateList=n.fundUpdates;l();n.isSaving=!1;toastr.success("Connection added successfully")},function(){toastr.error("Oops!  Problem creating update","There were some problems creating the update.  Please try again");n.isSaving=!1})):(toastr.info("Oops!  Description is required","Description is required.  Please fill it in."),n.isSaving=!1)};n.verifyDelete=function(n,t){n.isDeleting=t};n.updateFundUpdate=function(t){t.isUpdating=!0;t.statusId="Deleted";e.saveUpdate(t).then(function(){n.fundUpdates.splice(n.fundUpdates.indexOf(t),1);toastr.success("Connection updated successfully")},function(){toastr.error("Oops!  Problem removing update","There were some problems remove the update.  Please try again");t.isUpdating=!1})};n.initialize=function(){e.allUpdatesByFundIdStatusId(n.fundId).then(function(t){n.fundUpdates=t;n.addDeleting();n.isLoading=!1},function(i){t.error(i);toastr.error("Unable to get updates.  Please try again");n.isLoading=!1})};n.$on("Facebook:statusChange",function(t,i){console.log("Status: ",i);i.status=="connected"?n.$apply(function(){n.salutation=!0;n.byebye=!1}):n.$apply(function(){n.salutation=!1;n.byebye=!0;u(function(){n.byebye=!1},2e3)})})}],n.scope={fund:"=",fundId:"=",permalink:"=",showFeed:"@"},n});
/*
//# sourceMappingURL=fd-dashboard-widgets-updates-drctv.min.js.map
*/